# UX Maps Specification — Astrocartography Lines

- **Registry path**: `ux.maps.astrocartography.lines`
- **Status**: Documented placeholder (ready for implementation packets)
- **Maintainers**: UX & Maps Working Group
- **Updated**: 2025-10-02

## Purpose

Reserve the astrocartography rendering surface for v1 releases. The map plots Solar Fire calibrated planetary lines using Swiss Ephemeris vectors and atlas/timezone bundles vetted elsewhere in the repository. Outputs must always resolve to coordinates backed by real datasets—no synthetic plotting data is permitted.

## Data sources

| Asset | Location | Provenance | Usage |
| --- | --- | --- | --- |
| Swiss Ephemeris cache | `SE_EPHE_PATH` (see `datasets/swisseph_stub/README.md`) | Astrodienst Swiss Ephemeris (DE441) packages | Provides geocentric positions and velocities for line generation. |
| Dignities/weights | `profiles/base_profile.yaml`, `profiles/dignities.csv` | Solar Fire default transit profile (checksums recorded in `docs/provenance/solarfire_exports.md`) | Supplies severity multipliers for highlighting meridian/paran lines. |
| Atlas bundle | See `docs/ATLAS_TZ_SPEC.md` | GeoNames + Solar Fire place catalog, IANA tzdb, Natural Earth boundaries | Resolves lat/lon queries and timezone labels for map tooltips. |
| Star names | `datasets/star_names_iau.csv` | HYG Database v4.1 (commit `c7f7f883fe678cc7680169a50ccd7dcc49b060ce`) | Supports fixed-star overlays when enabled. |

## Indexing strategy

1. Pre-compute planetary line tables (MC/IC/ASC/DSC/paran) for the scan window using Swiss Ephemeris and persist them to `datasets/ux/astrocartography_lines.parquet` (to be generated by the ingestion job).
2. Partition the Parquet dataset by `body` and `line_kind` so the renderer can stream slices without scanning the entire file.
3. Record the Parquet checksum and build command in `docs/governance/data_revision_policy.md` every time the dataset is regenerated.

## Rendering contract

- **Inputs**: `{jd_utc, bodies[], severity_profile}`.
- **Outputs**: GeoJSON FeatureCollection where each feature contains `body`, `line_kind`, `start/end` coordinates, `severity_score`, `source_checksum`.
- **Determinism**: Re-rendering with identical inputs must yield byte-identical GeoJSON when sorted; test this via golden fixtures committed under `tests/observational/data/astrocartography/`.
- **Observability**: Emit `astroengine.ux.map.render_duration_ms` and attach dataset digests from `docs/provenance/solarfire_exports.md` and the atlas bundle manifest.

## Acceptance checklist

1. Verify Swiss Ephemeris availability (`python -c "import swisseph as swe; print(swe.__version__)"`).
2. Run `python scripts/swe_smoketest.py` and ensure the Julian Day output matches expectations.
3. Validate atlas datasets by running the smoke targets in `docs/ATLAS_TZ_SPEC.md` (e.g., timezone lookup for historical instants).
4. Generate sample map output for a known Solar Fire scenario (e.g., 2024-04-08 eclipse) and compare the line positions to the Solar Fire export within ±0.25°.

Record the command transcripts and comparison artefacts in the release notes.
