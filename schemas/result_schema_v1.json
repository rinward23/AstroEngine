{
  "$id": "https://astro.engine/schemas/result_schema_v1.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "AstroEngine Result Payload",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema",
    "run",
    "window",
    "subjects",
    "channels",
    "events"
  ],
  "properties": {
    "schema": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "version"
      ],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^astroengine\\.result$"
        },
        "version": {
          "type": "string",
          "pattern": "^v?1\\.0\\.[0-9]+$"
        }
      }
    },
    "run": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "profile",
        "generated_at",
        "engine_version",
        "ruleset_version"
      ],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^RUN-[A-Z0-9]{6,}$"
        },
        "profile": {
          "type": "string"
        },
        "generated_at": {
          "type": "string",
          "format": "date-time"
        },
        "engine_version": {
          "type": "string"
        },
        "ruleset_version": {
          "type": "string"
        },
        "seed": {
          "type": "integer"
        },
        "timezone": {
          "type": "string"
        }
      }
    },
    "window": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "start",
        "end",
        "timezone"
      ],
      "properties": {
        "start": {
          "type": "string",
          "format": "date-time"
        },
        "end": {
          "type": "string",
          "format": "date-time"
        },
        "timezone": {
          "type": "string"
        },
        "label": {
          "type": "string"
        }
      }
    },
    "subjects": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "token",
          "name",
          "role"
        ],
        "properties": {
          "token": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "role": {
            "type": "string"
          },
          "id": {
            "type": "string"
          },
          "consent": {
            "type": "boolean"
          }
        }
      }
    },
    "channels": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "id",
          "name",
          "score",
          "state"
        ],
        "properties": {
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "score": {
            "type": "number",
            "minimum": -100,
            "maximum": 100
          },
          "strength": {
            "type": "number",
            "minimum": 0,
            "maximum": 100
          },
          "state": {
            "type": "string",
            "enum": [
              "quiet",
              "rising",
              "steady",
              "surging",
              "peaking"
            ]
          },
          "subchannels": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "id",
                "name",
                "score",
                "state"
              ],
              "properties": {
                "id": {
                  "type": "string"
                },
                "name": {
                  "type": "string"
                },
                "score": {
                  "type": "number",
                  "minimum": -100,
                  "maximum": 100
                },
                "state": {
                  "type": "string",
                  "enum": [
                    "quiet",
                    "rising",
                    "steady",
                    "surging",
                    "peaking"
                  ]
                },
                "peaks": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "additionalProperties": false,
                    "required": [
                      "window_id",
                      "score"
                    ],
                    "properties": {
                      "window_id": {
                        "type": "string"
                      },
                      "score": {
                        "type": "number",
                        "minimum": -100,
                        "maximum": 100
                      },
                      "timestamp": {
                        "type": "string",
                        "format": "date-time"
                      }
                    }
                  }
                }
              }
            }
          },
          "peaks": {
            "type": "array",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "window_id",
                "score"
              ],
              "properties": {
                "window_id": {
                  "type": "string"
                },
                "score": {
                  "type": "number",
                  "minimum": -100,
                  "maximum": 100
                },
                "timestamp": {
                  "type": "string",
                  "format": "date-time"
                },
                "tier": {
                  "type": "string",
                  "enum": [
                    "major",
                    "notable",
                    "supporting"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "events": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "id",
          "datetime",
          "layer",
          "subject",
          "body",
          "aspect",
          "target",
          "channel",
          "orb",
          "valence",
          "strength"
        ],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^EVT-[A-Z0-9]{4,}$"
          },
          "datetime": {
            "type": "string",
            "format": "date-time"
          },
          "window_id": {
            "type": "string"
          },
          "window_label": {
            "type": "string"
          },
          "layer": {
            "type": "string"
          },
          "subject": {
            "type": "string"
          },
          "body": {
            "type": "string"
          },
          "aspect": {
            "type": "string"
          },
          "target": {
            "type": "string"
          },
          "channel": {
            "type": "string"
          },
          "orb": {
            "type": "number"
          },
          "valence": {
            "type": "number",
            "minimum": -1,
            "maximum": 1
          },
          "strength": {
            "type": "number",
            "minimum": 0,
            "maximum": 100
          },
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "time_bin": {
            "type": "string"
          },
          "day_tilt": {
            "type": "string"
          },
          "window_type": {
            "type": "string"
          },
          "strength_bin": {
            "type": "string"
          },
          "impact_axes": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "intent_hint": {
            "type": "string"
          },
          "channel_state": {
            "type": "string"
          },
          "is_major_event": {
            "type": "boolean"
          },
          "impact_flags": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "is_angular": {
            "type": "boolean"
          },
          "is_sensitive_degree": {
            "type": "boolean"
          },
          "is_declination_hit": {
            "type": "boolean"
          },
          "contributes_to_peak": {
            "type": "boolean"
          },
          "is_near_threshold": {
            "type": "boolean"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "notes": {
            "type": "string"
          },
          "elements": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "domains": {
            "type": "object",
            "additionalProperties": {
              "type": "number"
            }
          },
          "domain_profile": {
            "type": [
              "string",
              "null"
            ]
          }
        }
      }
    }
  }
}
